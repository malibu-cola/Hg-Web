# 巡回セールスマン問題

## 問題

4つの都市A, B, C, Dを最短で訪れる経路を求める。
スタートの都市は決まっていない。
各都市を結ぶ道の距離はわかっている。
![TravelSales1](./pic/TravelSales1.png)

## ソースコード

```python
from tytan import *

## q[i][j] = 都市jをi回目に訪れるなら1、そうでなければ0
q = symbols_list([4, 4])

H = 0
# i番目に訪れる都市は一つだけ。
for i in range(0, 4):
  H += (q[i][0] + q[i][1] + q[i][2] + q[i][3] - 1) ** 2
# 都市jに訪れるのは1回だけ
for j in range(0, 4):
  H += (q[0][j] + q[1][j] + q[2][j] + q[3][j] - 1) ** 2

dist = [[0.0, 0.3, 0.2, 0.6], 
        [0.3, 0.0, 0.1, 0.2], 
        [0.2, 0.1, 0.0, 0.3],
        [0.6, 0.2, 0.3, 0.0]]

# i番目からi + 1番目への移動
for i in range(0, 3):
  # 都市j1から
  for j1 in range(0, 4):
    # 都市j2への移動
    for j2 in range(0, 4):
      H += dist[j1][j2] * (q[i][j1] * q[i + 1][j2])

# コンパイル
qubo, offset = Compile(H).get_qubo()
print('offset', offset)
solver = sampler.SASampler()
result = solver.run(qubo)

for r in result[:5]:
  print(r)
  print(np.array(list(r[0].values())).reshape(4, 4))
  print()
```

## 結果

```
offset 8.0
[{'q0_0': 1, 'q0_1': 0, 'q0_2': 0, 'q0_3': 0, 'q1_0': 0, 'q1_1': 0, 'q1_2': 1, 'q1_3': 0, 'q2_0': 0, 'q2_1': 1, 'q2_2': 0, 'q2_3': 0, 'q3_0': 0, 'q3_1': 0, 'q3_2': 0, 'q3_3': 1}, -7.5, 18]
[[1 0 0 0]
 [0 0 1 0]
 [0 1 0 0]
 [0 0 0 1]]

[{'q0_0': 0, 'q0_1': 0, 'q0_2': 0, 'q0_3': 1, 'q1_0': 0, 'q1_1': 1, 'q1_2': 0, 'q1_3': 0, 'q2_0': 0, 'q2_1': 0, 'q2_2': 1, 'q2_3': 0, 'q3_0': 1, 'q3_1': 0, 'q3_2': 0, 'q3_3': 0}, -7.5, 2]
[[0 0 0 1]
 [0 1 0 0]
 [0 0 1 0]
 [1 0 0 0]]

[{'q0_0': 0, 'q0_1': 0, 'q0_2': 0, 'q0_3': 1, 'q1_0': 0, 'q1_1': 0, 'q1_2': 1, 'q1_3': 0, 'q2_0': 0, 'q2_1': 1, 'q2_2': 0, 'q2_3': 0, 'q3_0': 1, 'q3_1': 0, 'q3_2': 0, 'q3_3': 0}, -7.3, 10]
[[0 0 0 1]
 [0 0 1 0]
 [0 1 0 0]
 [1 0 0 0]]

[{'q0_0': 1, 'q0_1': 0, 'q0_2': 0, 'q0_3': 0, 'q1_0': 0, 'q1_1': 0, 'q1_2': 1, 'q1_3': 0, 'q2_0': 0, 'q2_1': 0, 'q2_2': 0, 'q2_3': 1, 'q3_0': 0, 'q3_1': 1, 'q3_2': 0, 'q3_3': 0}, -7.3, 3]
[[1 0 0 0]
 [0 0 1 0]
 [0 0 0 1]
 [0 1 0 0]]

[{'q0_0': 0, 'q0_1': 0, 'q0_2': 1, 'q0_3': 0, 'q1_0': 1, 'q1_1': 0, 'q1_2': 0, 'q1_3': 0, 'q2_0': 0, 'q2_1': 1, 'q2_2': 0, 'q2_3': 0, 'q3_0': 0, 'q3_1': 0, 'q3_2': 0, 'q3_3': 1}, -7.3, 1]
[[0 0 1 0]
 [1 0 0 0]
 [0 1 0 0]
 [0 0 0 1]]
```
最適解は1つめのA→C→B→Dと2つめのD→B→C→Aで、順路を逆にした答えになっている。